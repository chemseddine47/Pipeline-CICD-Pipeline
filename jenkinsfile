stage('Deploy') {
    
    agent any

    steps {
        withCredentials([string(credentialsId: 'GITHUB_TOKEN', variable: 'GITHUB_TOKEN')]) {
            sh '''
                git config user.name "chemseddine47"
                git config user.email "chemseddine.nemeur@gmail.com"
                cd "$WORKSPACE"
                git checkout gh-pages || git checkout --orphan gh-pages
                rm -rf *
                cp -r build/* .
                git add .
                git commit -m "Deploying to GitHub Pages"
                git push https://${GITHUB_TOKEN}@github.com/chemseddine47/Pipeline-CICD-Pipeline.git gh-pages
            '''
        }
    }
}